"use strict";(self.webpackChunkblog_waku_org=self.webpackChunkblog_waku_org||[]).push([[79],{73158:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var n=a(87462),r=(a(67294),a(3905));const o={layout:"post",name:"Scaling Waku: A Progress Update",title:"Scaling Waku: A Progress Update",date:new Date("2023-09-25T00:00:00.000Z"),authors:"mf",published:!0,slug:"scaling-waku-progress-update",categories:"scaling, waku, progress, milestones",image:"/img/black-waku-logo-with-name.png",hide_table_of_contents:!1},i="Scaling Waku: A Progress Update",s={permalink:"/scaling-waku-progress-update",source:"@site/posts/2023-09-21-scaling-waku-a-progress-update.mdx",title:"Scaling Waku: A Progress Update",description:"A glance into how Waku has progressed its scaling capabilities throughout 2023",date:"2023-09-25T00:00:00.000Z",formattedDate:"September 25, 2023",tags:[],readingTime:7.61,hasTruncateMarker:!0,authors:[{name:"mf",twitter:"@0x_m_f",github:"DeBelg",key:"mf"}],frontMatter:{layout:"post",name:"Scaling Waku: A Progress Update",title:"Scaling Waku: A Progress Update",date:"2023-09-25T00:00:00.000Z",authors:"mf",published:!0,slug:"scaling-waku-progress-update",categories:"scaling, waku, progress, milestones",image:"/img/black-waku-logo-with-name.png",hide_table_of_contents:!1},prevItem:{title:"The Waku Roadmap",permalink:"/waku-roadmap"},nextItem:{title:"Device Pairing in Js-waku and Go-waku",permalink:"/device-pairing-in-js-waku-and-go-waku"}},l={authorsImageUrls:[void 0]},u=[{value:"Overview",id:"overview",level:2},{value:"Laying the theoretical groundwork",id:"laying-the-theoretical-groundwork",level:2},{value:"Theoretical Analysis of Scaling gossipsub",id:"theoretical-analysis-of-scaling-gossipsub",level:3},{value:"Static sharding",id:"static-sharding",level:3},{value:"Bridging theory to practice",id:"bridging-theory-to-practice",level:2},{value:"Simulations",id:"simulations",level:3},{value:"Status telemetry analysis",id:"status-telemetry-analysis",level:3},{value:"Hands-on achievements",id:"hands-on-achievements",level:2},{value:"Protocol service improvements",id:"protocol-service-improvements",level:3},{value:"- PostgreSQL transition",id:"--postgresql-transition",level:4},{value:"- Filter protocol redesign",id:"--filter-protocol-redesign",level:4},{value:"- <strong>Waku peer exchange</strong>",id:"--waku-peer-exchange",level:4},{value:"Connectivity: discovering and managing peers",id:"connectivity-discovering-and-managing-peers",level:3},{value:"DoS protection",id:"dos-protection",level:3},{value:"Building for builders",id:"building-for-builders",level:3},{value:"- Docs",id:"--docs",level:4},{value:"- C API",id:"--c-api",level:4},{value:"Setting the stage for growth",id:"setting-the-stage-for-growth",level:2},{value:"<strong>Contribute to the decentralisation of communication.</strong>",id:"contribute-to-the-decentralisation-of-communication",level:2}],c={toc:u};function p(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"A glance into how Waku has progressed its scaling capabilities throughout 2023"),(0,r.kt)("p",null,"As we move forward into the last months 2023, our primary goal has been to solidify the scalability of Waku protocols, focusing on Status Communities."),(0,r.kt)("p",null,"We have ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/waku-org/pm/issues/12"},"set and reached")," our milestone of providing a Waku network that can scale to approximately 10K ",(0,r.kt)("em",{parentName:"p"},"active")," users in Status Communities. While continuing to provide ",(0,r.kt)("a",{parentName:"p",href:"https://status.im"},"Status")," the required network services to make such a community viable, we believe that the research, protocols, tools, and solutions we are working on will allow the overall Waku network to scale to over a million nodes."),(0,r.kt)("p",null,"To meet Status's timeline for the Communities feature, the Waku team made some tough decisions that required tradeoffs in terms of decentralization and other design goals. However, this approach has allowed us to demonstrate the core stability and scalability of Waku's protocols, while continuously working towards long-term solutions that provide better anonymity, robustness, and decentralization features."),(0,r.kt)("p",null,"This article will continue diving deeper into what we did and where you can learn more about these topics. If you're already keen to get your hands dirty, we have recently published our upgraded ",(0,r.kt)("a",{parentName:"p",href:"https://docs.waku.org"},"Waku documentation"),", allowing us to build faster, ",(0,r.kt)("a",{parentName:"p",href:"https://docs.waku.org/community/"},"together"),"."),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"#laying-the-theoretical-groundwork"}," ",(0,r.kt)("strong",{parentName:"a"},"Theoretical: Laying the groundwork"))),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Theoretical Analysis of Scaling Gossipsub."),(0,r.kt)("li",{parentName:"ul"},"Static Sharding"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"#bridging-theory-to-practice"},(0,r.kt)("strong",{parentName:"a"},"Bridging theory to practice"))),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Simulations"),(0,r.kt)("li",{parentName:"ul"},"Status Telemetry Analysis"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"#hands-on-achievements"},(0,r.kt)("strong",{parentName:"a"},"Hands-on achievements"))),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Status MVP Delivery (Scaled Waku Communities to 10k)"),(0,r.kt)("li",{parentName:"ul"},"Protocol Service Improvements",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"PostgreSQL transition"),(0,r.kt)("li",{parentName:"ul"},"Waku Peer Exchange"),(0,r.kt)("li",{parentName:"ul"},"Filter Protocol Redesign"))),(0,r.kt)("li",{parentName:"ul"},"Status DoS mitigation mechanism"),(0,r.kt)("li",{parentName:"ul"},"Building for builders",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Waku Docs upgrade"),(0,r.kt)("li",{parentName:"ul"},"C API"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"#contribute-to-the-decentralisation-of-communication"},(0,r.kt)("strong",{parentName:"a"},"Contribute to the decentralisation of communication"))))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"laying-the-theoretical-groundwork"},"Laying the theoretical groundwork"),(0,r.kt)("h3",{id:"theoretical-analysis-of-scaling-gossipsub"},"Theoretical Analysis of Scaling gossipsub"),(0,r.kt)("p",null,"We started in Q1 by doing a ",(0,r.kt)("a",{parentName:"p",href:"https://hackmd.io/IYmyyUIdSEuRZ7WbYd6dng?view"},"theoretical analysis (mathematical modelling)")," of GossipSub scaling under certain conditions."),(0,r.kt)("p",null,"The numbers for our message rates and sizes chosen for the model come from the telemetric analysis of typical traffic on significantly sizable Discord servers and existing Status Communities. From this, we conclude that the Waku Relay network can scale to 10,000 nodes per shard."),(0,r.kt)("p",null,"Suppose we further assume that each Status Community operates on a separate shard. In that case, each community can scale to 10,000 ",(0,r.kt)("em",{parentName:"p"},"active")," relay-only users while bandwidth usage remains within a reasonable range for each user."),(0,r.kt)("p",null,"Realistically most community nodes are not active simultaneously, so this approach could scale to ~100,000 nodes per community if roughly 1/10th of users are active at any time."),(0,r.kt)("h3",{id:"static-sharding"},"Static sharding"),(0,r.kt)("p",null,"Based on the analyses above, we published ",(0,r.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/spec/57/"},"an RFC"),', bringing together an integrated strategy to scale Status Communities based on static sharding. This requires manually selecting and configuring static shard(s) per community, with no sharing of shards between communities. Static sharding provides a simple way to achieve scalability with reasonable Denial of Service (DoS) protection (more on that below) but also requires some trade-offs in decentralisation and anonymity. Therefore, our longer-term strategy is to provide a way to auto-scale the Waku network with "autosharding" - this allows multiple applications and communities to share the same set of shards without intervening manually in the underlying message routing strategies.'),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/waku-org/research/issues/3"},"This Github issue")," provides more information on our network strategy as we advance. In the near future you can expect an elaborated post on our strategy & roadmap."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"bridging-theory-to-practice"},"Bridging theory to practice"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"simulations"},"Simulations"),(0,r.kt)("p",null,"To test our theoretical conclusions, the Distributed Systems Testing (DST) team ran extensive simulations using a Waku simulation tool built on the Kurtosis framework, ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/vacp2p/wakurtosis"},"Wakurtosis"),"."),(0,r.kt)("p",null,"The DST team has recently published a ",(0,r.kt)("a",{parentName:"p",href:"https://docs.google.com/document/d/1U3bzlbk_Z3ZxN9tPAnORfYdPRWyskMuShXbdxCj4xOM/edit"},"summary report")," detailing these conclusions about scalability, matching our theoretical expectations while showing that the nwaku client can deal with the resource overhead in a growing network."),(0,r.kt)("p",null,"While achieving full-scale simulations of 10,000 nodes posed challenges, initial simulations of up to 1000 nodes aligned with our mathematical models. This gave us confidence in the viability of our approach."),(0,r.kt)("h3",{id:"status-telemetry-analysis"},"Status telemetry analysis"),(0,r.kt)("p",null,"Having drawn theoretical conclusions under which a Waku Relay network would scale, we then experimented to verify our conclusions. Afterwards we performed a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/vacp2p/vac-book/blob/main/scratch/status-scaling/status-telemetry-analysis.md"},"telemetric analysis")," of current Status Community traffic."),(0,r.kt)("p",null,"This allowed us to discover potential bottlenecks when sending large messages over Waku, determine major bandwith usage, and propose strategies to help Status Communities reasonably use Waku without compromising its scalability."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"hands-on-achievements"},"Hands-on achievements"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"protocol-service-improvements"},"Protocol service improvements"),(0,r.kt)("p",null,"To cater to the needs of a growing network of users on diverse platforms, the team improved (and in some cases wholly redesigned) our existing protocols based on the lessons we have learned from dogfooding the Waku network. Of these, the changes to the store and filter protocols were the most significant."),(0,r.kt)("h4",{id:"--postgresql-transition"},"- PostgreSQL transition"),(0,r.kt)("p",null," To be able to retrieve an increasing amount of large history queries & messages from our store protocol, we have ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/waku-org/pm/issues/4"},"transitioned")," from a simple SQLite backend to a more robust PostgreSQL archive. This allows store nodes to serve multiple queries in parallel while improving message reliability through redundancy."),(0,r.kt)("h4",{id:"--filter-protocol-redesign"},"- Filter protocol redesign"),(0,r.kt)("p",null,"The filter protocol allows resource-restricted devices to receive only a subset of messages routed in the network. We have redesigned ",(0,r.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/spec/12/"},"the entire filter protocol")," to be more robust and provide features requested by Waku-based applications, such as refreshing existing subscriptions."),(0,r.kt)("p",null,"This new filter protocol version is currently being dogfooded within both mobile and desktop production environment, and the initial feedback is prominently positive."),(0,r.kt)("h4",{id:"--waku-peer-exchange"},"- ",(0,r.kt)("strong",{parentName:"h4"},"Waku peer exchange")),(0,r.kt)("p",null," We have designed and then created a discovery mechanism suitable for resource-restricted nodes called ",(0,r.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/spec/34/"},"Waku peer exchange"),". Work on all these protocols empowers nodes, including resource-restricted devices, to participate seamlessly, ensuring that the network remains accessible to all."),(0,r.kt)("h3",{id:"connectivity-discovering-and-managing-peers"},"Connectivity: discovering and managing peers"),(0,r.kt)("p",null,"A Waku network can only function well if we make it efficient for nodes to connect and interact."),(0,r.kt)("p",null,'During the first half of 2023, we spent significant effort improving how a node discovers peers and manages its connectivity to those peers. We have boosted a node\'s ability to differentiate between "good" and "bad" connections, including integrating ',(0,r.kt)("a",{parentName:"p",href:"https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/gossipsub-v1.1.md#peer-scoring"},"gossipsub peer scoring"),"."),(0,r.kt)("p",null,"Thanks to the introduction of ",(0,r.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/spec/57/#libp2p-rendezvous-and-circuit-relay"},"libp2p rendezvous discovery"),", nodes behind restrictive NATs can now make themselves discoverable and connect to other nodes by coordinating a NAT hole punch via a ",(0,r.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/spec/57/#libp2p-rendezvous-and-circuit-relay"},"circuit-relay connection"),"."),(0,r.kt)("p",null,"We have also modified ",(0,r.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/spec/51/#discovery"},"discovery")," methods such as ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ethereum/devp2p/blob/master/discv5/discv5.md"},"discv5"),", to consider static sharding when filtering discovered nodes."),(0,r.kt)("h3",{id:"dos-protection"},"DoS protection"),(0,r.kt)("p",null,"One of the most important considerations of any Waku network deployment is protecting the network against spam and DOS attacks. While we are still working on productising a ",(0,r.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/spec/17/"},"privacy-preserving spam protection mechanism based on rate-limiting nullifiers"),", we focused in H1 on developing a simple DoS mitigation mechanism for Status Communities."),(0,r.kt)("p",null,"This requires all messages belonging to a community to be signed with a key distributed to all community members. Since static sharding ensures messages are only routed within a community, each relayer in the Waku network can validate that each routed message truly originated from within the community and discard those that did not."),(0,r.kt)("h3",{id:"building-for-builders"},"Building for builders"),(0,r.kt)("h4",{id:"--docs"},"- Docs"),(0,r.kt)("p",null,"We are continuing to make building on Waku more accessible than ever. We have redesigned and improved our ",(0,r.kt)("a",{parentName:"p",href:"https://docs.waku.org/"},"docs website"),", making it easier for you to get acquainted with our work."),(0,r.kt)("h4",{id:"--c-api"},"- C API"),(0,r.kt)("p",null,"The nwaku client has recently seen the introduction of ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/waku-org/nwaku/tree/b9d5d28af5afcc2589357a132c9b5beb57202828/examples/cbindings"},"a C API")," that can be seamlessly wrapped in multiple programming languages (see the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/waku-org/nwaku/tree/b9d5d28af5afcc2589357a132c9b5beb57202828/examples/python"},"Python wrapper")," as an example), an efficient ",(0,r.kt)("a",{parentName:"p",href:"https://docs.waku.org/guides/nodes-and-sdks/"},"addition")," to our existing languages and frameworks support. By simplifying the process of integrating nwaku as a service node into other applications, we are fostering an environment where more projects can actively build on Waku and contribute to the Waku network."),(0,r.kt)("h2",{id:"setting-the-stage-for-growth"},"Setting the stage for growth"),(0,r.kt)("p",null,"This post provides a glimpse into the Waku Team's progress in the first half of 2023."),(0,r.kt)("p",null,"Our sights are currently set on taking what we have learned and building a ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/waku-org/research/issues/1"},"viable public Waku Network")," that can scale to even larger numbers while maintaining our core ",(0,r.kt)("a",{parentName:"p",href:"https://status.im/about/#our-principles"},"principles")," of open-access, privacy-preservation, decentralisation, and transparency about trade-offs."),(0,r.kt)("p",null,"Conquering those research & development challenges will not only scale Waku, but will play a significant role in growing and scaling Status Communities. Where we now have made certain trade-offs, our end-goal and principles are aligned in our end-goals, you'll soon read more about our goals and milestones in our upcoming Roadmap."),(0,r.kt)("p",null,"As a team, we remain dedicated to this mandate while acknowledging the vast involvement of community members and collaborators who contribute to our journey."),(0,r.kt)("h2",{id:"contribute-to-the-decentralisation-of-communication"},(0,r.kt)("strong",{parentName:"h2"},"Contribute to the decentralisation of communication.")),(0,r.kt)("p",null,"Help us ensure that we are staying decentralised by ",(0,r.kt)("a",{parentName:"p",href:"https://docs.waku.org/guides/run-nwaku-node"},"running your own Waku Node!")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null},"Integrate Waku in your application"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"nwaku"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://github.com/waku-org/nwaku"},"https://github.com/waku-org/nwaku"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Browser (JS/TS)"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://github.com/waku-org/js-waku"},"https://github.com/waku-org/js-waku"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Go"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://github.com/waku-org/go-waku"},"https://github.com/waku-org/go-waku"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Rust"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://github.com/waku-org/waku-rust-bindings"},"https://github.com/waku-org/waku-rust-bindings"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"More\u2026"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://docs.waku.org/guides/nodes-and-sdks"},"https://docs.waku.org/guides/nodes-and-sdks"))))),(0,r.kt)("p",null,"Soon we will also release our upcoming roadmap."),(0,r.kt)("p",null,"Stay tuned, and follow our ",(0,r.kt)("a",{parentName:"p",href:"https://twitter.com/Waku_org"},"Twitter")," to keep yourself updated on new launches. Say hello to us on ",(0,r.kt)("a",{parentName:"p",href:"https://discord.gg/GdJJh38sZR"},"Discord"),", ",(0,r.kt)("a",{parentName:"p",href:"https://jobs.status.im/"},"join our team"),", or crack some of our ",(0,r.kt)("a",{parentName:"p",href:"https://github.org/waku-org/bounties"},"bounties"),"  --- No need to remain shy!"),(0,r.kt)("hr",null),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"em"},"Written by Mf & Hanno 09/2023"))))}p.isMDXComponent=!0},3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),u=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(a),h=r,m=d["".concat(l,".").concat(h)]||d[h]||p[h]||o;return a?n.createElement(m,i(i({ref:t},c),{},{components:a})):n.createElement(m,i({ref:t},c))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var u=2;u<o;u++)i[u]=a[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"}}]);