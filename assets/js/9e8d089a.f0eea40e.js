"use strict";(self.webpackChunkblog_waku_org=self.webpackChunkblog_waku_org||[]).push([[5549],{8821:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>h});var o=a(87462),n=(a(67294),a(3905));const r={layout:"post",name:"The Waku Network: Technical Overview",title:"The Waku Network: Technical Overview",date:new Date("2024-03-26T00:00:00.000Z"),authors:["franck"],published:!0,slug:"2024-waku-network-tech-overview",categories:"waku, technical, network",image:"/img/black-waku-logo-with-name.png",hide_table_of_contents:!1},s=void 0,i={permalink:"/2024-waku-network-tech-overview",source:"@site/posts/2024-03-26-waku-network-tech-overview.mdx",title:"The Waku Network: Technical Overview",description:"A comprehensive overview of the Waku Network.",date:"2024-03-26T00:00:00.000Z",formattedDate:"March 26, 2024",tags:[],readingTime:11.61,hasTruncateMarker:!0,authors:[{name:"Franck",twitter:"fryorcraken",github:"fryorcraken",key:"franck"}],frontMatter:{layout:"post",name:"The Waku Network: Technical Overview",title:"The Waku Network: Technical Overview",date:"2024-03-26T00:00:00.000Z",authors:["franck"],published:!0,slug:"2024-waku-network-tech-overview",categories:"waku, technical, network",image:"/img/black-waku-logo-with-name.png",hide_table_of_contents:!1},prevItem:{title:"March Progress Report",permalink:"/march-progress"},nextItem:{title:"The convergence of AI, Blockchain and Privacy",permalink:"/convergence-of-ai-blockchain-privacy"}},l={authorsImageUrls:[void 0]},h=[{value:"Origin",id:"origin",level:2},{value:"Challenges / desired properties",id:"challenges--desired-properties",level:2},{value:"The Waku Network",id:"the-waku-network",level:2},{value:"Peer discovery",id:"peer-discovery",level:3},{value:"Message Routing - Gossipsub",id:"message-routing---gossipsub",level:3},{value:"Message routing - sharding",id:"message-routing---sharding",level:3},{value:"Message routing - autosharding",id:"message-routing---autosharding",level:3},{value:"Message Routing - RLN Relay",id:"message-routing---rln-relay",level:3},{value:"Servicing Mostly-offline and Resource-restricted Devices",id:"servicing-mostly-offline-and-resource-restricted-devices",level:3},{value:"The Waku Network&#39;s value proposition",id:"the-waku-networks-value-proposition",level:2},{value:"Are we  <em>blank</em> yet?",id:"are-we--blank-yet",level:2},{value:"Conclusion",id:"conclusion",level:2}],u={toc:h};function d(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,o.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"A comprehensive overview of the Waku Network. "),(0,n.kt)("hr",null),(0,n.kt)("p",null,"Last December ",(0,n.kt)("a",{parentName:"p",href:"https://thedefiant.io/waku-launches-first-decentralised-privacy-preserving-dos-protections-for-peer-to-peer-messaging"},"we announced the Waku Network"),"."),(0,n.kt)("p",null,"The Waku Network is the first decentralised and privacy-preserving network that provides Denial-of-Service (DoS) protections for peer-to-peer messaging. It aims to enhance privacy and security in peer-to-peer communication by implementing innovative protocols and technologies."),(0,n.kt)("p",null,"Let us dig deeper into the why and what the Waku Network is."),(0,n.kt)("h2",{id:"origin"},"Origin"),(0,n.kt)("p",null,"If you have been following Waku or Status, you are likely to be familiar with the origin of Waku.\nThe Status mobile app was created to be a web3 super app, a portal to the Ethereum ecosystem that leverages the three original pillars: Ethereum for consensus, Swarm for storage and Whisper for communication."),(0,n.kt)("p",null,"The Status development team attempted to build Status with Whisper, but this protocol had fundamental limitations, especially for resource-restricted devices, such as mobile phones."),(0,n.kt)("p",null,"Waku was born as a successor of Whisper, learning from its flaws to provide a scalable peer-to-peer communication network fit for mobile and browsers."),(0,n.kt)("h2",{id:"challenges--desired-properties"},"Challenges / desired properties"),(0,n.kt)("p",null,"Waku aims to overcome the following challenges:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Generalised messaging: Waku aims to provide protocols and a network that enables the transfer of arbitrary payloads. While Waku was originally created for a chat application, Status, the aim is to be generalised enough to build any decentralised communication or signalling application on Waku."),(0,n.kt)("li",{parentName:"ul"},"Ephemeral messaging: Waku aims to solve the problem of real-time communication, which aims to provide fair latency to enable one or several users to exchange small data payloads. This is in contrast to IPFS or other decentralised storage systems, which provide a way to store large amounts of data at the expense of latency and responsiveness."),(0,n.kt)("li",{parentName:"ul"},"Censorship-resistance: Waku aims to provide a censorship-resistant solution where external actors cannot block users' access to the Waku infrastructure. But also for app developers to be able to build with a ",(0,n.kt)("em",{parentName:"li"},"cannot do evil")," mindset where they do not have the key to the kingdom and the ability to deplatform their users."),(0,n.kt)("li",{parentName:"ul"},"Privacy-minded: To provide the ability for app developers to operate on a ",(0,n.kt)("em",{parentName:"li"},"cannot do evil")," principle in terms of data and metadata collection of their users. This means that even if they wanted or were pressured to they, or any third party, could not collect metadata such as social graphs or activity patterns from their users."),(0,n.kt)("li",{parentName:"ul"},"Anonymity: Similarly to privacy, this is the ability for users to not link Personal Identifiable Information (PII) to their activity on the Waku network or application using the network. PII considered here are in regards to the network (IP address), blockchain (e.g. Ethereum address), and routing (message correlation)."),(0,n.kt)("li",{parentName:"ul"},"Resource-restricted devices: as previously mentioned, when designing Waku, an effort is made to consider environments such as mobile and browser to enable developers to build DApps for these platforms and provide as many of the properties listed above as possible."),(0,n.kt)("li",{parentName:"ul"},"Scalability: Waku aims to support millions of users while maintaining the principles above; this needs to be thoughtfully designed and tested.\n")),(0,n.kt)("p",null,"All the properties above mean that other problems need to be overcome when designing Waku:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"DOS protection: ensuring that the network cannot be flooded with messages, leading users who have fewer resources to be booted off the network."),(0,n.kt)("li",{parentName:"ul"},"Network sustainability and incentivisation: How do we ensure enough resources in the network to enable devices such as browsers and mobile devices to access the network?"),(0,n.kt)("li",{parentName:"ul"},"Decentralisation: Waku needs to be decentralised at several levels to enable those properties. How do we maintain a fair level of decentralisation to ensure those properties remain over time?\n")),(0,n.kt)("h2",{id:"the-waku-network"},"The Waku Network"),(0,n.kt)("p",null,"How does the Waku Network help deliver the properties above?"),(0,n.kt)("p",null,"Let us review the different Waku protocols that are combined in the network and how they enable us to achieve this feat."),(0,n.kt)("h3",{id:"peer-discovery"},"Peer discovery"),(0,n.kt)("p",null,"For any peer-to-peer system to be reliable and decentralised, there must be a mechanism to find new peers or nodes in said system, usually called ",(0,n.kt)("em",{parentName:"p"},"peer discovery"),"."),(0,n.kt)("p",null,"Waku uses discv5, similar to Ethereum. Minor enhancements to ENR have been done to enable the Waku node to advertise:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"the shards they are operating in (see ",(0,n.kt)("a",{parentName:"li",href:"#message-routing--sharding"},"message routing - sharding"),")"),(0,n.kt)("li",{parentName:"ul"},"the protocol they have enabled"),(0,n.kt)("li",{parentName:"ul"},"alternative multiaddr they may have, e.g., for the browser to connect to the said node via WebSocket.\n")),(0,n.kt)("p",null,"Discv5 is decentralised, which can prevent potential sybil attacks where an attacker tries to surround the victim's node to give a manipulated view of the network."),(0,n.kt)("p",null,"This helps enable anonymity, privacy, and censorship resistance."),(0,n.kt)("p",null,"Thanks to the protocol serviced being advertised, it enables mobile phones and the browser to find nodes that can service them."),(0,n.kt)("h3",{id:"message-routing---gossipsub"},"Message Routing - Gossipsub"),(0,n.kt)("p",null,"Similar to Ethereum, Waku uses libp2p-gossipsub. This brings several benefits:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"improved bandwidth performance in comparison to Whisper: in gossipsub, nodes form a group of neighbours (mesh) to which they send messages. A given node will only attempt to maintain connections and actively exchange messages with other nodes. Reducing the number of times each message is uploaded or downloaded."),(0,n.kt)("li",{parentName:"ul"},"Reliability: gossipsub has built-in redundancy, which gives fair reliability when operating in a decentralised peer-to-peer network, where no node can be trusted to be reliable or well-behaved."),(0,n.kt)("li",{parentName:"ul"},"Anonymity: as nodes forward messages from other nodes in their mesh, and no metadata is present on individual messages (e.g., no plain text signature), this provides fair anonymity as it is not possible for an observer to know if their neighbour originated or forwarded a message. This works when combined with a decentralised peer discovery mechanism such as discv5.\n")),(0,n.kt)("p",null,"We named Waku's usage of gossipsub, the protocol and the network. ",(0,n.kt)("strong",{parentName:"p"},"Waku Relay.")),(0,n.kt)("h3",{id:"message-routing---sharding"},"Message routing - sharding"),(0,n.kt)("p",null,"One of the drawbacks of Gossipsub is that every node in the network receives and sends every message of the network, with some amplification."),(0,n.kt)("p",null,"One can see how this limits scalability: it cannot be expected to traffic the whole traffic of the network from a household internet connection."),(0,n.kt)("p",null,"To solve this problem, sharding is used instead of having one gossipsub network. The Waku network is subdivided into several distinct message-routing subnetworks, or shards.\nCurrently, the Waku network is split into eight shards."),(0,n.kt)("p",null,"It means that any user of a Waku application would only relay the traffic of one shard or one-eighth (approximately) of the whole network."),(0,n.kt)("p",null,"Eight was a small, arbitrary number to start with. Our theoretical analysis shows that a shard can support around 10k active users while maintaining an average bandwidth requirement of around 4Mbps, meaning 80k for the whole network. We are working on running further simulations to confirm our assumptions. We are also onboarding developers and users on the network to test the theory.\nThe aim is to increase the number of shards in the network over time."),(0,n.kt)("p",null,"Thanks to the enhancements made to discv5, nodes can know what shards other peers are servicing before connecting to them."),(0,n.kt)("h3",{id:"message-routing---autosharding"},"Message routing - autosharding"),(0,n.kt)("p",null,"One issue with sharding is that users and applications must know what shard to use."),(0,n.kt)("p",null,"One application could arbitrarily decide what shard they want to use, but that may take a lot of work, especially when adding new shards. It is also one more decision for the developer to make; we prefer to make the developer experience as easy as possible. It also allows developers to build applications that spread on several shards without delegating shard choices to the user."),(0,n.kt)("p",null,"Autosharding is a simple protocol that dispatches messages on a shard based on the application."),(0,n.kt)("h3",{id:"message-routing---rln-relay"},"Message Routing - RLN Relay"),(0,n.kt)("p",null,'Waku is generalised and privacy-preserving, meaning any kind of payload can be transported. Hence, there is no strict definition of "spam". Whether the message contains a ',(0,n.kt)("a",{parentName:"p",href:"https://github.com/b4s36t4/waku-meme"},"meme")," or a ",(0,n.kt)("a",{parentName:"p",href:"https://railgun.ch/#/"},"zk note for private DeFi"),", Waku shouldn't even know the content; metadata and data should remain private."),(0,n.kt)("p",null,"Hence, there is a risk of someone pushing gigabits of data to the network. This can be a problem at different levels:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Bandwidth usage: This may lead to a user's bandwidth being hogged and affecting other services (streaming, staking) or a surprise bill."),(0,n.kt)("li",{parentName:"ul"},"Connectivity: if a node does not have enough bandwidth to send/receive all messages on the gossipsub layer, then their behaviour may be seen as incorrect by other nodes that may disconnect from it."),(0,n.kt)("li",{parentName:"ul"},"Reliability: If the traffic is higher than the available bandwidth, then a node may not be able to send and receive messages reliably."),(0,n.kt)("li",{parentName:"ul"},"Other resources: memory usage is correlated with the traffic, and so is disk space for a store service.\n")),(0,n.kt)("p",null,'So rather than defining what a "spam" message looks like, we introduced a rate limit on the network to enable a fair use of Waku, with a capping of the bandwidth usage per shard.'),(0,n.kt)("p",null,"This is done with RLN, or Rate Limiting Nullifier, which limits the rate of messages a given publisher sends.\nIt is currently set to 1 msg/s. Coupled with a maximum message size (150kB) and a maximum number of publishers (80k, TBD), we can assume a maximum bandwidth usage per shard of ",(0,n.kt)("a",{parentName:"p",href:"https://docs.waku.org/research/research-and-studies/capped-bandwidth"},"around 10Mbps"),". Read more about the maximum bandwidth ",(0,n.kt)("a",{parentName:"p",href:"https://docs.waku.org/research/research-and-studies/maximum-bandwidth"},"here"),"."),(0,n.kt)("p",null,"Rate-limiting publishers in a censorship-resistant and private manner is difficult; this is why we are using zero-knowledge technology:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Users push their RLN credentials to a smart contract (currently on Ethereum Sepolia testnet)."),(0,n.kt)("li",{parentName:"ol"},"Nodes keep track of all registered memberships on the contract."),(0,n.kt)("li",{parentName:"ol"},"When sending a message, the user attaches an RLN proof to the message with the current epoch (timestamp in seconds)."),(0,n.kt)("li",{parentName:"ol"},"Nodes can verify the proof without being able to correlate the user's Ethereum address (used on the smart contract) with the message being sent, preserving anonymity."),(0,n.kt)("li",{parentName:"ol"},"If a user attempts to send more than 1 msg/s, nodes can detect this and drop the message surplus or spam, protecting the network.")),(0,n.kt)("h3",{id:"servicing-mostly-offline-and-resource-restricted-devices"},"Servicing Mostly-offline and Resource-restricted Devices"),(0,n.kt)("p",null,"Finally, how is Waku useful to resource-restricted devices, such as mobile phones and web browsers?\nWaku defines a number of ",(0,n.kt)("a",{parentName:"p",href:"https://rfc.vac.dev/spec/10/#requestreply-domain"},"request-response protocols")," to enable such devices to access the Waku network without having to be always online or consume extensive amounts of bandwidth, i.e., without participating in the Waku Relay network.\nThe ",(0,n.kt)("a",{parentName:"p",href:"https://docs.waku.org/learn/concepts/protocols#light-push"},"light push protocol")," sends a message to be forwarded to the Waku Relay network, with acknowledgement of reception from the remote node."),(0,n.kt)("p",null,"The ",(0,n.kt)("a",{parentName:"p",href:"https://docs.waku.org/learn/concepts/protocols/#filter"},"filter protocol")," enables a ",(0,n.kt)("em",{parentName:"p"},"light client")," to subscribe to a remote peer and only request a subset of messages instead of all messages transmitted on a shard."),(0,n.kt)("p",null,"Finally, the store protocol enables ",(0,n.kt)("em",{parentName:"p"},"light clients")," and ",(0,n.kt)("em",{parentName:"p"},"relay nodes")," to retrieve historical messages that may have been missed."),(0,n.kt)("h2",{id:"the-waku-networks-value-proposition"},"The Waku Network's value proposition"),(0,n.kt)("p",null,"While we have defined the desired properties and the technology, it is important to understand the potential use cases of the Waku Network. This ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/waku-org/docs.waku.org/issues/134"},"issue")," currently describes several USPs (Unique Value Propositions), and we will be documenting the subject further. Some noteworthy use cases are, beyond building any machine-to-machine or human-to-human communication app:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"No-Infra DApps: combining various decentralised technologies (Waku, Ethereum, IPFS) to deploy a DApp without paying a centralised hosting provider."),(0,n.kt)("li",{parentName:"ul"},"Censorship-resistant access to a decentralised network for light clients: using the request-response protocols to enable light clients to access your peer-to-peer network without relying on a centralised, censorable web gateway."),(0,n.kt)("li",{parentName:"ul"},"Signal network: Use The Waku Network to find other peers and negotiate specific parameters to form your own peer-to-peer, Waku or not, network with different rules (higher rate limit, etc.).")),(0,n.kt)("h2",{id:"are-we--blank-yet"},"Are we  ",(0,n.kt)("em",{parentName:"h2"},"blank")," yet?"),(0,n.kt)("p",null,"We have described Waku's desired properties and how the Waku Network delivers on those. Does it mean Waku is censorship-resistant, private, sustainable, and scalable? ",(0,n.kt)("em",{parentName:"p"},"Not quite.")),(0,n.kt)("p",null,"Bootstrapping is a component of all peer-to-peer networks we did not address: how does a new node find other nodes in the network? We use Ethereum technology for bootstrapping (ENR + DNS Discovery). However, this technology could be more decentralised. We intend to improve this potential around the end of 2024 or 2025."),(0,n.kt)("p",null,"In general, the network needs to be decentralised to achieve the desired properties. While some of the technology enables such decentralisation (and we are working on improving the part that does not), this problem has a social component. If the Waku team is the only one running nodes, then inherently, the network cannot be considered decentralised, and hence censorship-resistant, etc. To solve this, we need to push for the adoption of the Waku network so we can build a good base of node operators and developers that run nodes without depending on the Waku team to do so."),(0,n.kt)("p",null,"We increased this effort last year and will continue this year."),(0,n.kt)("p",null,"Another aspect is providing monetary incentivisation to node operators to run nodes so the network can become self-sustainable. We do not have such a protocol; we are building the first PoC."),(0,n.kt)("p",null,"The Waku Network plays an important role here. Once such a protocol is available, a common (market) place is needed for developers/users and operators to find each other; the Waku Network would be such a place."),(0,n.kt)("h2",{id:"conclusion"},"Conclusion"),(0,n.kt)("p",null,"Waku aims to enable sovereign communications with specific properties. The Waku Network is a critical milestone towards achieving such a goal and creating a common, decentralisable network on which developers can build, and we can add more protocols."),(0,n.kt)("p",null,"While we cannot say that Waku is all it aims to be today, it is already permissionless and decentralisable on several layers."),(0,n.kt)("p",null,"We are now working on not only adding the missing pieces to the protocols but also pushing for Waku's adoption to make it de facto decentralised, enabling private & censorship resistance for everyone."),(0,n.kt)("hr",null),(0,n.kt)("p",null,"If you have questions about Waku\u2019s development roadmap or want to join a like-minded community focused on bringing peer-to-peer communications to millions of users, join the Waku ",(0,n.kt)("a",{parentName:"p",href:"https://discord.waku.org/"},"Discord")," or follow us on ",(0,n.kt)("a",{parentName:"p",href:"https://twitter.com/Waku_org"},"X"),"."),(0,n.kt)("p",null,"If the technology speaks to you, ",(0,n.kt)("a",{parentName:"p",href:"https://https//status.app/jobs/"},"check out our open job positions")," or crack some of our ",(0,n.kt)("a",{parentName:"p",href:"https://github.org/waku-org/bounties"},"bounties"),"."),(0,n.kt)("p",null,"You can also help to ensure that we stay decentralised by ",(0,n.kt)("a",{parentName:"p",href:"https://docs.waku.org/guides/nwaku/run-node"},"running your own Waku Node!")))}d.isMDXComponent=!0},3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>c});var o=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,o,n=function(e,t){if(null==e)return{};var a,o,n={},r=Object.keys(e);for(o=0;o<r.length;o++)a=r[o],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)a=r[o],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=o.createContext({}),h=function(e){var t=o.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},u=function(e){var t=h(e.components);return o.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=h(a),c=n,m=p["".concat(l,".").concat(c)]||p[c]||d[c]||r;return a?o.createElement(m,s(s({ref:t},u),{},{components:a})):o.createElement(m,s({ref:t},u))}));function c(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,s=new Array(r);s[0]=p;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:n,s[1]=i;for(var h=2;h<r;h++)s[h]=a[h];return o.createElement.apply(null,s)}return o.createElement.apply(null,a)}p.displayName="MDXCreateElement"}}]);